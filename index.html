<!DOCTYPE html>
<html>
<head>
  <style>
    .node {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #36A2EB;
      color: white;
      text-align: center;
      line-height: 40px;
      position: absolute;
      cursor: pointer;
      user-select: none;
    }
    .tree-container {
      position: relative;
      width: 1200px;
      height: 800px;
      margin: 0 auto;
      border: 1px solid #ccc;
      overflow: auto;
    }
    .edge {
      position: absolute;
      border: 1px solid #36A2EB;
    }
  </style>
</head>
<body>
  <div class="tree-container" id="tree"></div>
  <script>
    const tree = document.getElementById('tree');
    const nodes = new Map(); // نگاشت گره‌ها به آدرس‌ها
    const MAX_DEPTH = 10; // حداکثر عمق برای جلوگیری از خرابی

    function generateWalletAddress() {
      // تولید آدرس تصادفی شبیه به آدرس‌های Polygon
      return "0x" + Math.random().toString(16).substr(2, 40).padEnd(40, '0');
    }

    function createNode(id, x, y) {
      try {
        const depth = id.length;
        if (depth > MAX_DEPTH) return null;

        const wallet = nodes.get(id) || (id === "" ? "0x82F7dBe1792436d15bdA22bB3340bD3f45D614Fa" : generateWalletAddress());
        nodes.set(id, wallet);

        const node = document.createElement('div');
        node.className = 'node';
        node.style.left = x + 'px';
        node.style.top = y + 'px';
        node.innerText = id + "\n" + wallet.slice(0, 6) + "...";
        node.onclick = () => expandNode(id, x, y);
        tree.appendChild(node);
        return node;
      } catch (e) {
        console.error("Error creating node:", e);
        return null;
      }
    }

    function drawEdge(x1, y1, x2, y2) {
      try {
        const edge = document.createElement('div');
        edge.className = 'edge';
        edge.style.left = (x1 + 20) + 'px';
        edge.style.top = (y1 + 20) + 'px';
        const dx = x2 - x1;
        const dy = y2 - y1;
        const length = Math.sqrt(dx * dx + dy * dy);
        const angle = Math.atan2(dy, dx) * 180 / Math.PI;
        edge.style.width = length + 'px';
        edge.style.transform = rotate(${angle}deg);
        edge.style.transformOrigin = '0 0';
        tree.appendChild(edge);
      } catch (e) {
        console.error("Error drawing edge:", e);
      }
    }

    function expandNode(id, x, y) {
      try {
        const depth = id.length;
        if (depth >= MAX_DEPTH) return;

        const leftId = id + "0";
        const rightId = id + "1";
        if (!nodes.has(leftId) && !nodes.has(rightId)) {
          const newY = y + 60;
          const leftX = x - 120 / (depth + 2);
          const rightX = x + 120 / (depth + 2);
          createNode(leftId, leftX, newY);
          createNode(rightId, rightX, newY);
          drawEdge(x + 20, y + 20, leftX + 20, newY + 20);
          drawEdge(x + 20, y + 20, rightX + 20, newY + 20);
        }
      } catch (e) {
        console.error("Error expanding node:", e);
      }
    }

    // ریشه با آدرس قرارداد Polygonscan
    const rootId = "";
    const rootX = 600;
    const rootY = 20;
    createNode(rootId, rootX, rootY);
  </script>
</body>
</html>